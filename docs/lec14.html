<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Nonparametric regression</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="SI-md-08.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geographic Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="lec01.html">Introduction to the course</a>
    </li>
    <li>
      <a href="lec02.html">Univariate plots</a>
    </li>
    <li>
      <a href="lec03.html">Bivariate plots</a>
    </li>
    <li>
      <a href="lec04.html">Descriptive statistics</a>
    </li>
    <li>
      <a href="lec05.html">Multivariate plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2 versions of basic plots</a>
    </li>
    <li>
      <a href="lec06.html">Maps in R</a>
    </li>
    <li>
      <a href="lec07.html">Geospatial analysis in R</a>
    </li>
    <li>
      <a href="lec08.html">Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="lec09.html">Reference distributions</a>
    </li>
    <li>
      <a href="lec10.html">Statistical inference</a>
    </li>
    <li>
      <a href="lec11.html">Analysis of variance</a>
    </li>
    <li>
      <a href="lec12.html">Regression analysis</a>
    </li>
    <li>
      <a href="lec13.html">More regression analysis</a>
    </li>
    <li>
      <a href="lec14.html">Nonparametric regression</a>
    </li>
    <li>
      <a href="lec15.html">GLMs, GAMs, and CARTs</a>
    </li>
    <li>
      <a href="lec16.html">Principal components and factor analyses</a>
    </li>
    <li>
      <a href="lec17.html">MANOVA and discriminant analysis</a>
    </li>
    <li>
      <a href="lec18.html">Multivariate distances and cluster analysis</a>
    </li>
    <li>
      <a href="lec19.html">High-resolution and high-dimension data</a>
    </li>
    <li>
      <a href="lec20.html">Analysis and visualization of large raster data sets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Exercises</li>
    <li>
      <a href="ex01.html">Exercise 01 -- Getting R and RStudio</a>
    </li>
    <li>
      <a href="ex02.html">Exercise 02 -- Univariate plots</a>
    </li>
    <li>
      <a href="ex03.html">Exercise 03 -- Bivariate plots and descriptive statistics</a>
    </li>
    <li>
      <a href="ex04.html">Exercise 04 -- Multivariate plots</a>
    </li>
    <li>
      <a href="ex05.html">Exercise 05 -- Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="ex06.html">Exercise 06 -- CI's, t-tests, ANOVA</a>
    </li>
    <li>
      <a href="ex07.html">Exercise 07 -- Regression analysis</a>
    </li>
    <li>
      <a href="ex08.html">Exercise 08 -- Multivariate analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="packages-and-data.html">Packages and data</a>
    </li>
    <li>
      <a href="vm_inst.html">Virtual machine instructions</a>
    </li>
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="datasets.html">Datasets</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Nonparametric regression</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#specific-and-general-cases-of-smoothing-and-nonparametric-regression"><span class="toc-section-number">2</span> Specific and general cases of smoothing and nonparametric regression</a><ul>
<li><a href="#a-review-of-global-fitting-e.g.linear-regression"><span class="toc-section-number">2.1</span> A review of global fitting (e.g. linear regression)</a></li>
<li><a href="#loess-curves"><span class="toc-section-number">2.2</span> Loess curves</a></li>
</ul></li>
<li><a href="#examples-of-nonparametric-regression"><span class="toc-section-number">3</span> Examples of nonparametric regression</a><ul>
<li><a href="#lowess"><span class="toc-section-number">3.1</span> lowess()</a></li>
<li><a href="#loess"><span class="toc-section-number">3.2</span> loess()</a></li>
<li><a href="#loess-surfaces"><span class="toc-section-number">3.3</span> loess() surfaces</a></li>
<li><a href="#other-bivariate-smoothers"><span class="toc-section-number">3.4</span> Other bivariate smoothers</a><ul>
<li><a href="#least-squares-line"><span class="toc-section-number">3.4.1</span> Least-squares line</a></li>
<li><a href="#least-squares-polynomials"><span class="toc-section-number">3.4.2</span> Least-squares polynomials</a></li>
<li><a href="#smoothing-spline"><span class="toc-section-number">3.4.3</span> Smoothing spline</a></li>
</ul></li>
</ul></li>
<li><a href="#summary-of-smoothers"><span class="toc-section-number">4</span> Summary of smoothers</a></li>
<li><a href="#readings"><span class="toc-section-number">5</span> Readings</a></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p>
<span style="color: #FF0040;">NOTE: Not yet revised for Spring 2020</span>
</p>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Scatter-diagram smoothing (e.g. using the <code>lowess()</code> or <code>loess()</code> functions) involves drawing a smooth curve on a scatter diagram to summarize a relationship, in a fashion that makes few assumptions initially about the form or strength of the relationship. It is related to (and is a special case of) <em>nonparametric regression</em>, in which the objective is to represent the relationship between a response variable and one or more predictor variables, again in way that makes few assumptions about the form of the relationship. In other words, in contrast to “standard” linear regression analysis, no assumption is made that the relationship is represented by a straight line (although one could certainly think of a straight line as a special case of nonparametric regression).</p>
<p>If the basic decomposition-of-the-data model is:</p>
<p>        <em>data = predictable component + noise</em>,</p>
<p>then for the standard bivariate or multiple (linear) regression, the model is</p>
<p>        <em>data = straight-line, polynomial or linearizable function + noise</em>,</p>
<p>while for nonparametric regression, the model is</p>
<p>        <em>data = smooth function determined by data + noise</em>.</p>
<p>Another way of looking at scatter diagram smoothing is as a way of depicting the “local” relationship between a response variable and a predictor variable over parts of their ranges, which may differ from a “global” relationship determined using the whole data set. (And again, the idea of “local” as opposed to “global” relationships has an obvious geographical analogy.) Nonparametric regression can be thought of as generalizing the scatter plot smoothing idea to the multiple-regression context.</p>
</div>
<div id="specific-and-general-cases-of-smoothing-and-nonparametric-regression" class="section level1">
<h1><span class="header-section-number">2</span> Specific and general cases of smoothing and nonparametric regression</h1>
<div id="a-review-of-global-fitting-e.g.linear-regression" class="section level2">
<h2><span class="header-section-number">2.1</span> A review of global fitting (e.g. linear regression)</h2>
<p>In ordinary linear regression analysis, the objective can be considered to be drawing a line through the data in an optimal way, where the parameters (regression coefficients) are determined using all of the data, i.e. they are globally determined. However, it is possible to think of the line as connecting the points, that for each value of X, represent the local density maxima of Y–it just happens that these local maxima happen to be arranged along a straight line.</p>
<ul>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/images/nwk2_3.gif">the scatter diagram and fitted line</a></li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/images/nwk2_4.gif">the conceptual model that underlies the interpretation of the line</a></li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/images/nwk2_5.gif">curvilinear regression</a></li>
</ul>
</div>
<div id="loess-curves" class="section level2">
<h2><span class="header-section-number">2.2</span> Loess curves</h2>
<p>A bivariate smoother is a function or procedure for drawing a smooth curve through a scatter diagram. Like linear regression (in which the “curve” is a straight line), the smooth curve is drawn in such a way as to have some desirable properties. In general, the properties are that the curve indeed be smooth, and that locally, the curve minimize the variance of the residuals or prediction error.</p>
<p>The bivariate smoother used most frequently in practice is known as a “lowess” or “loess” curve. The acronyms are meant to represent the notion of locally weighted regression–a curve- or function-fitting technique that provides a generally smooth curve, the value of which at a particular location along the x-axis is determined only by the points in that vicinity. The method consequently makes no assumptions about the form of the relationship, and allows the form to be discovered using the data itself. (The difference between the two acronyms or names is mostly superficial, but there is an actual difference in R–there are two different functions, <code>lowess()</code> and <code>loess()</code>, the former is an older, simple scatter-diagram-smoothing function, while the latter is newer and more flexible. There is also the <code>locfit</code> (local regression) package that is more flexible still.)</p>
<p>The mechanics of loess:</p>
<ul>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/images/v3_7.gif">the locally weighted “fitted value” at a particular point</a></li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/images/v3_8.gif">what happens at the margin of the scatter diagram</a></li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/topics/loess.pdf">the mathematics of loess</a></li>
</ul>
<p>The parameters of an individual <code>loess()</code> curve:</p>
<ul>
<li><em>span</em> -a value between 0 and 1 controlling the amount of smoothing, with smaller values resulting in less smoothing. Typical values lie in the range of .3 to .5. Span can be considered to represent the width of the smoothing window.</li>
<li><em>degree</em> -the degree of the locally-fitted polynomial. 1 = locally linear fitting (i.e. a line), 2 = locally quadratic quadratic fitting (i.e. a parabola).</li>
<li><em>family</em> -either “Symmetric” or “Gaussian” The symmetric option combines the local fitting with a “robustness” step that discounts the influence of unusual points, while the Gaussian option does not.</li>
</ul>
<p><a href="lec14.html">[Back to top]</a></p>
</div>
</div>
<div id="examples-of-nonparametric-regression" class="section level1">
<h1><span class="header-section-number">3</span> Examples of nonparametric regression</h1>
<p>The first examples of nonparametric regression are the familiar scatter diagram smoother <code>lowess()</code> and the related, more flexible <code>loess()</code> function.</p>
<p>Load some packages, and attach a data set of annual temperatures at Oregon climate stations.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">attach</span>(ortann)</a></code></pre></div>
<pre><code>## The following object is masked from midwtf2:
## 
##     latitude</code></pre>
<pre><code>## The following objects are masked from orstationc:
## 
##     station, tann</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">names</span>(ortann)</a></code></pre></div>
<pre><code>## [1] &quot;station&quot;   &quot;latitude&quot;  &quot;longitude&quot; &quot;elevation&quot; &quot;tann&quot;</code></pre>
<p>Look at the annual temperature data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">plot</span>(elevation, tann, <span class="dt">pch=</span><span class="dv">16</span>)</a></code></pre></div>
<p><img src="lec14_files/figure-html/low03-1.png" width="1350" /></p>
<p>Note that there are actually two versions of the lowess or loess scatter-diagram smoothing approach implemented in R <code>lowess()</code> and <code>loess()</code>. The former function (<code>lowess()</code>) was implemented first, while the latter (<code>loess()</code>) is more flexible and powerful. Because the function names are pronouced similarly, they are often confused, but because they basically do the same thing, that’s not such a big deal.</p>
<div id="lowess" class="section level2">
<h2><span class="header-section-number">3.1</span> lowess()</h2>
<p>A simple “lowess/loess” curve is constructed using the <code>lowess()</code> function, which finds a “fitted” value for each data point; these can be plotted as individual symbols, but they are usually connected with lines. The lowess() function has a “span” argument (sometimes symbolized by <font face="Symbol">l</font>) that represents the proportion of the total number of points that contribute to each local fitted value. In practice, the <code>lowess()</code> function is often embedded in a <code>points()</code> or ’lines()` function.</p>
<p>In the following, the specific fitted values produced by the <code>lowess()</code> function (one per data point) are plotted in red, and the lowess curve is added, also in red. On top of that, two additional curves are plotted (in magenta and purple) that show the effect of the smoothing parameter choice. The green curve is smoother than the default (<font face="Symbol">l</font> = 0.667), and the magenta curve is “looser” than the default (<font face="Symbol">l</font> = 0.33).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># lowess</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">plot</span>(elevation, tann, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">points</span>(<span class="kw">lowess</span>(elevation, tann), <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">cex=</span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="kw">lines</span>(<span class="kw">lowess</span>(elevation,tann), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co"># different smoothing</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="kw">lines</span>(<span class="kw">lowess</span>(elevation, tann, <span class="dt">f=</span><span class="fl">0.33</span>), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="kw">lines</span>(<span class="kw">lowess</span>(elevation, tann, <span class="dt">f=</span><span class="fl">0.80</span>), <span class="dt">col=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;lowess() spans&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;0.667&quot;</span>,<span class="st">&quot;0.8&quot;</span>,<span class="st">&quot;0.33&quot;</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;purple&quot;</span>))</a></code></pre></div>
<p><img src="lec14_files/figure-html/low04-1.png" width="1350" /></p>
</div>
<div id="loess" class="section level2">
<h2><span class="header-section-number">3.2</span> loess()</h2>
<p>The newer <code>loess()</code> function uses a formula to specify the response (and in its application as a scatter-diagram smoother) a single predictor variable. The <code>loess()</code> function creates an object that contains the results, and the <code>predict()</code> function retrieves the fitted values. These can then be plotted along with the response variable. However, the points must be plotted in increasing order of the predictor variable values in order for the <code>lines()</code> function to draw the line in an appropriate fashion. This is done by using the results of the <code>order()</code> function applied to the predictor variable values, and the explicit subscripting (in square brackets <code>[ ]</code>) to arrange the observations in ascending order.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># loess -- first model</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">loess.model &lt;-<span class="st"> </span><span class="kw">loess</span>(tann <span class="op">~</span><span class="st"> </span>elevation)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">loess.model</a></code></pre></div>
<pre><code>## Call:
## loess(formula = tann ~ elevation)
## 
## Number of Observations: 92 
## Equivalent Number of Parameters: 4.69 
## Residual Standard Error: 0.8758</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># second model, smoother curve</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">loess.model2 &lt;-<span class="st"> </span><span class="kw">loess</span>(tann <span class="op">~</span><span class="st"> </span>elevation, <span class="dt">span=</span><span class="fl">0.90</span>, <span class="dt">degree=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">loess.model2</a></code></pre></div>
<pre><code>## Call:
## loess(formula = tann ~ elevation, span = 0.9, degree = 2)
## 
## Number of Observations: 92 
## Equivalent Number of Parameters: 4.04 
## Residual Standard Error: 0.8752</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># plot the curves</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">plot</span>(tann <span class="op">~</span><span class="st"> </span>elevation, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">hat1 &lt;-<span class="st"> </span><span class="kw">predict</span>(loess.model)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">lines</span>(elevation[<span class="kw">order</span>(elevation)], hat1[<span class="kw">order</span>(elevation)], <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">hat2 &lt;-<span class="st"> </span><span class="kw">predict</span>(loess.model2)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw">lines</span>(elevation[<span class="kw">order</span>(elevation)], hat2[<span class="kw">order</span>(elevation)], <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;loess() model&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;span=0.667, deg=1&quot;</span>,<span class="st">&quot;span=0.9, deg=2&quot;</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>))</a></code></pre></div>
<p><img src="lec14_files/figure-html/low07-1.png" width="1350" /></p>
</div>
<div id="loess-surfaces" class="section level2">
<h2><span class="header-section-number">3.3</span> loess() surfaces</h2>
<p>A locally determined surface can be constructed using <code>loess()</code> which is not limited to a single predictor variable, by first fitting a model that illustrates the response of the response variable as a function of two (or more) location variables, and then using the <code>predict()</code> function to visualize the resulting surface:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># tann as a function of latitude and longitude (and interaction)</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">tann.loess &lt;-<span class="st"> </span><span class="kw">loess</span>(tann <span class="op">~</span><span class="st"> </span>longitude <span class="op">+</span><span class="st"> </span>latitude, <span class="dt">span=</span><span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">summary</span>(tann.loess)</a></code></pre></div>
<pre><code>## Call:
## loess(formula = tann ~ longitude + latitude, span = 0.3)
## 
## Number of Observations: 92 
## Equivalent Number of Parameters: 21.11 
## Residual Standard Error: 0.9942 
## Trace of smoother matrix: 25.23  (exact)
## 
## Control settings:
##   span     :  0.3 
##   degree   :  2 
##   family   :  gaussian
##   surface  :  interpolate      cell = 0.2
##   normalize:  TRUE
##  parametric:  FALSE FALSE
## drop.square:  FALSE FALSE</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># poor man&#39;s R-squared value</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">cor</span>(tann, tann.loess<span class="op">$</span>fitted)<span class="op">^</span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 0.8098961</code></pre>
<p>Now create an interpolation “target” grid, get the predicted (i.e. interpolated) values, and plot the results.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># create an interpolation target grid to display predicted values</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">grid.longitude &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="fl">124.5000</span>, <span class="fl">-116.8333</span>, <span class="fl">.1667</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">grid.latitude &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">42.0000</span>, <span class="fl">46.1667</span>, <span class="fl">.0833</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">grid.mar &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">longitude=</span>grid.longitude, <span class="dt">latitude=</span>grid.latitude)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co"># get the fitted (interpolated) values</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7">tann.interp &lt;-<span class="st"> </span><span class="kw">predict</span>(tann.loess, <span class="kw">expand.grid</span>(grid.mar))</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">tann.z &lt;-<span class="st"> </span><span class="kw">matrix</span>(tann.interp, <span class="kw">length</span>(grid.longitude),</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="kw">length</span>(grid.latitude))</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co"># plot the interpolated values as shaded rectangles and contours</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12">nclr &lt;-<span class="st"> </span><span class="dv">8</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13">plotclr &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(nclr, <span class="st">&quot;PuOr&quot;</span>)</a>
<a class="sourceLine" id="cb17-14" data-line-number="14">plotclr &lt;-<span class="st"> </span>plotclr[nclr<span class="op">:</span><span class="dv">1</span>] <span class="co"># reorder colors</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="kw">plot</span>(orotl.shp)</a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="kw">image</span>(grid.longitude, grid.latitude, tann.z, <span class="dt">col=</span>plotclr, <span class="dt">add=</span>T)</a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="kw">contour</span>(grid.longitude, grid.latitude, tann.z, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="kw">points</span>(longitude, latitude)</a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="kw">plot</span>(orotl.shp, <span class="dt">add=</span>T)</a></code></pre></div>
<p><img src="lec14_files/figure-html/low10-1.png" width="2100" /></p>
</div>
<div id="other-bivariate-smoothers" class="section level2">
<h2><span class="header-section-number">3.4</span> Other bivariate smoothers</h2>
<p>Loess is one of a number of smoothers (including linear regression as an end-member) that can be used. The different smoothers vary in the assumptions they make about</p>
<ul>
<li>the form of the relationship</li>
<li>the influence of individual points</li>
</ul>
<p>The other scatter diagram smoothers include a straight, or “least-squares” line, a low-order polynomial least-squares line, and the “smoothing spline”. Each can be viewed as special cases of the more flexible loess-type smoothers in which the curve is very simple. The best way to understand these different smoothers is to compare them:</p>
<div id="least-squares-line" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Least-squares line</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># first-order polynomial (i.e. a straight line)</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">linear.model &lt;-<span class="st"> </span><span class="kw">lm</span>(tann <span class="op">~</span><span class="st"> </span>elevation)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">linear.model</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tann ~ elevation)
## 
## Coefficients:
## (Intercept)    elevation  
##   11.688139    -0.003238</code></pre>
</div>
<div id="least-squares-polynomials" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Least-squares polynomials</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># second order polynomial</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">poly2.model &lt;-<span class="st"> </span><span class="kw">lm</span>(tann <span class="op">~</span><span class="st"> </span>elevation<span class="op">+</span><span class="st"> </span><span class="kw">I</span>(elevation<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">poly2.model</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tann ~ elevation + I(elevation^2))
## 
## Coefficients:
##    (Intercept)       elevation  I(elevation^2)  
##      1.133e+01      -1.147e-03      -1.459e-06</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">poly2.hat &lt;-<span class="st"> </span><span class="kw">predict</span>(poly2.model)</a></code></pre></div>
</div>
<div id="smoothing-spline" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Smoothing spline</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">spline.model &lt;-<span class="st"> </span><span class="kw">smooth.spline</span>(elevation, tann)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">spline.model</a></code></pre></div>
<pre><code>## Call:
## smooth.spline(x = elevation, y = tann)
## 
## Smoothing Parameter  spar= 1.12444  lambda= 0.003202393 (15 iterations)
## Equivalent Degrees of Freedom (Df): 5.311004
## Penalized Criterion (RSS): 63.56046
## GCV: 0.800279</code></pre>
<p>Plot the differnt smoothers</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">plot</span>(tann <span class="op">~</span><span class="st"> </span>elevation, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">abline</span>(linear.model, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="kw">lines</span>(elevation[<span class="kw">order</span>(elevation)], poly2.hat[<span class="kw">order</span>(elevation)],</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">     <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="kw">lines</span>(spline.model, <span class="dt">col=</span><span class="st">&quot;purple&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="kw">legend</span>(<span class="st">&quot;bottomleft&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;smoothers&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;linear&quot;</span>,<span class="st">&quot;polynomial&quot;</span>,<span class="st">&quot;spline&quot;</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;purple&quot;</span>))</a></code></pre></div>
<p><img src="lec14_files/figure-html/low14-1.png" width="1350" /> <a href="lec14.html">[Back to top]</a></p>
</div>
</div>
</div>
<div id="summary-of-smoothers" class="section level1">
<h1><span class="header-section-number">4</span> Summary of smoothers</h1>
<p>The various smoothers can be summarized as follows</p>
<table>
<thead>
<tr class="header">
<th>Assumptions</th>
<th>Smoother</th>
<th>Form</th>
<th>Influence of individual points</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>fewest</em></td>
<td>loess</td>
<td>no assumptions</td>
<td>unusual points discounted</td>
</tr>
<tr class="even">
<td></td>
<td>smoothing spline</td>
<td>smooth curve</td>
<td>some discounting of unusual points</td>
</tr>
<tr class="odd">
<td></td>
<td>robust, robust MM</td>
<td>straight line</td>
<td>unusual points discounted</td>
</tr>
<tr class="even">
<td></td>
<td>least squares (curvilinear)</td>
<td>curve</td>
<td>all points influential</td>
</tr>
<tr class="odd">
<td><em>most</em></td>
<td>least squares (linear)</td>
<td>straight line</td>
<td>all points influential</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><a href="lec14.html">[Back to top]</a></p>
</div>
<div id="readings" class="section level1">
<h1><span class="header-section-number">5</span> Readings</h1>
<ul>
<li>Kuhnert &amp; Venebles (<em>An Introduction…</em>): p. 120-128</li>
<li>Cleveland (<em>Visualizing Data</em>) Ch. 3</li>
</ul>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
