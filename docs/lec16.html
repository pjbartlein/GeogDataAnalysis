<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Principal components and factor analysis</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


<link rel="stylesheet" href="SI-md-08.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Geographic Data Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="lec01.html">Introduction to the course</a>
    </li>
    <li>
      <a href="lec02.html">Univariate plots</a>
    </li>
    <li>
      <a href="lec03.html">Bivariate plots</a>
    </li>
    <li>
      <a href="lec04.html">Descriptive statistics</a>
    </li>
    <li>
      <a href="lec05.html">Multivariate plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2 versions of basic plots</a>
    </li>
    <li>
      <a href="lec06.html">Maps in R</a>
    </li>
    <li>
      <a href="lec07.html">Geospatial analysis in R</a>
    </li>
    <li>
      <a href="lec08.html">Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="lec09.html">Reference distributions</a>
    </li>
    <li>
      <a href="lec10.html">Statistical inference</a>
    </li>
    <li>
      <a href="lec11.html">Analysis of variance</a>
    </li>
    <li>
      <a href="lec12.html">Regression analysis</a>
    </li>
    <li>
      <a href="lec13.html">More regression analysis</a>
    </li>
    <li>
      <a href="lec14.html">Nonparametric regression</a>
    </li>
    <li>
      <a href="lec15.html">GLMs, GAMs, and CARTs</a>
    </li>
    <li>
      <a href="lec16.html">Principal components and factor analyses</a>
    </li>
    <li>
      <a href="lec17.html">MANOVA and discriminant analysis</a>
    </li>
    <li>
      <a href="lec18.html">Multivariate distances and cluster analysis</a>
    </li>
    <li>
      <a href="lec19.html">High-resolution and high-dimension data</a>
    </li>
    <li>
      <a href="lec20.html">Analysis and visualization of large raster data sets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Exercises</li>
    <li>
      <a href="ex01.html">Exercise 01 -- Getting R and RStudio</a>
    </li>
    <li>
      <a href="ex02.html">Exercise 02 -- Univariate plots</a>
    </li>
    <li>
      <a href="ex03.html">Exercise 03 -- Bivariate plots and descriptive statistics</a>
    </li>
    <li>
      <a href="ex04.html">Exercise 04 -- Multivariate plots</a>
    </li>
    <li>
      <a href="ex05.html">Exercise 05 -- Data wrangling and matrix algebra</a>
    </li>
    <li>
      <a href="ex06.html">Exercise 06 -- CI's, t-tests, ANOVA</a>
    </li>
    <li>
      <a href="ex07.html">Exercise 07 -- Regression analysis</a>
    </li>
    <li>
      <a href="ex08.html">Exercise 08 -- Multivariate analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="packages-and-data.html">Packages and data</a>
    </li>
    <li>
      <a href="vm_inst.html">Virtual machine instructions</a>
    </li>
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="datasets.html">Datasets</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Principal components and factor analysis</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#derivation-of-principal-components-and-their-properties"><span class="toc-section-number">2</span> Derivation of principal components and their properties</a></li>
<li><a href="#pca-examples"><span class="toc-section-number">3</span> PCA Examples</a>
<ul>
<li><a href="#pca-of-a-two-variable-matrix"><span class="toc-section-number">3.1</span> PCA of a two-variable matrix</a></li>
<li><a href="#a-second-example-using-the-large-cites-data-set"><span class="toc-section-number">3.2</span> A second example using the large-cites data set</a>
<ul>
<li><a href="#examining-the-correlation-matrix"><span class="toc-section-number">3.2.1</span> Examining the correlation matrix</a></li>
<li><a href="#pca-of-the-cities-data"><span class="toc-section-number">3.2.2</span> PCA of the cities data</a></li>
</ul></li>
<li><a href="#rotation-of-principal-components"><span class="toc-section-number">3.3</span> “Rotation” of principal components</a></li>
</ul></li>
<li><a href="#factor-analyis-fa-and-pca"><span class="toc-section-number">4</span> Factor analyis (FA) and PCA</a>
<ul>
<li><a href="#example-of-a-factor-analysis"><span class="toc-section-number">4.1</span> Example of a factor analysis</a></li>
</ul></li>
<li><a href="#a-second-example-controls-of-mid-holocene-aridity-in-eurasia"><span class="toc-section-number">5</span> A second example: Controls of mid-Holocene aridity in Eurasia</a>
<ul>
<li><a href="#read-and-transform-the-data"><span class="toc-section-number">5.1</span> Read and transform the data</a></li>
<li><a href="#correlations-among-variables"><span class="toc-section-number">5.2</span> Correlations among variables</a></li>
<li><a href="#pca-of-the-pmip-3-data"><span class="toc-section-number">5.3</span> PCA of the PMIP 3 data</a></li>
<li><a href="#qgraph-plot-of-the-principal-components"><span class="toc-section-number">5.4</span> qgraph plot of the principal components</a></li>
<li><a href="#rotated-components"><span class="toc-section-number">5.5</span> Rotated components</a></li>
</ul></li>
<li><a href="#readings"><span class="toc-section-number">6</span> Readings</a></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p>
<span style="color: #00cc00;">NOTE: This page has been revised for Winter 2021, but may undergo further edits.</span>
</p>
<div id="introduction" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Introduction</h1>
<p><em>Principal components analysis (PCA)</em> is a widely used multivariate analysis method, the general aim of which is to reveal systematic covariations among a group of variables. The analysis can be motivated in a number of different ways, including (in geographical contexts) finding groups of variables that measure the same underlying dimensions of a data set, describing the basic anomaly patterns that appear in spatial data sets, or producing a general index of the common variation of a set of variables.</p>
<ul>
<li>Example: Davis’ boxes (<a href="https://pjbartlein.github.io/GeogDataAnalysis/images/Davis_PCA_data.png">data</a>, <a href="https://pjbartlein.github.io/GeogDataAnalysis/images/Davis_PCA_boxes_png">plot</a>, <a href="https://pjbartlein.github.io/GeogDataAnalysis/images/Davis_PCA_scatter.png">scatter</a>, <a href="https://pjbartlein.github.io/GeogDataAnalysis/images/Davis_PCA_scores.png">components</a>), (Davis, J.C., 2001, <em>Statistics and Data Analysis in Geology</em>, Wiley)</li>
</ul>
</div>
<div id="derivation-of-principal-components-and-their-properties" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Derivation of principal components and their properties</h1>
<p>The formal derivation of principal components analysis requires the use of matix algebra.</p>
<ul>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/topics/matrix.pdf">[Matrix algebra]</a></li>
<li><a href="https://pjbartlein.github.io/GeogDataAnalysis/topics/pca.html">[Derivation of principal components]</a></li>
</ul>
<p>Because the components are derived by solving a particular optimization problem, they naturally have some “built-in” properties that are desirable in practice (e.g. maximum variability). In addition, there are a number of other properties of the components that can be derived:</p>
<ul>
<li><em>variances</em> of each component, and the <em>proportion of the total variance</em> of the original variables are are given by the eigenvalues;</li>
<li>component <em>scores</em> may be calculated, that illustrate the value of each component at each observation;</li>
<li>component <em>loadings</em> that describe the correlation between each component and each variable may also be obtained;</li>
<li>the <em>correlations among the original variables</em> can be reproduced by the <em>p</em>-components, as can that part of the correlations “explained” by the first q components.</li>
<li>the <em>original data can be reproduced</em> by the <em>p</em> components, as can those parts of the original data “explained” by the first <em>q</em> components;</li>
<li>the components can be “<em>rotated</em>” to increase the interpretability of the components.</li>
</ul>
<p><a href="lec16.html">[Back to top]</a></p>
</div>
<div id="pca-examples" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> PCA Examples</h1>
<div id="pca-of-a-two-variable-matrix" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> PCA of a two-variable matrix</h2>
<p>A classic data set for illustrating PCA is one that appears in John C. Davis’s 2002 book <em>Statistics and data analysis in geology</em>, Wiley (UO Library, QE48.8 .D38 2002). The data consist of 25 boxes or blocks with random dimensions (the long, intermediate and short axes of the boxes), plus some derived variables, like the length of the longest diagonal that can be contained within a box.</p>
<p>Here’s the data: <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/boxes_csv">[boxes_csv]</a></p>
<p>In this example, a simple two-variable (long-axis length and diagonal length) data set is created using Davis’ artificial data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#boxes_pca -- principal components analysis of Davis boxes data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>boxes_matrix <span class="ot">&lt;-</span> <span class="fu">data.matrix</span>(<span class="fu">cbind</span>(boxes[,<span class="dv">1</span>],boxes[,<span class="dv">4</span>]))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(boxes_matrix) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">cbind</span>(<span class="st">&quot;long&quot;</span>,<span class="st">&quot;diag&quot;</span>))</span></code></pre></div>
<p>Matrix scatter plot of the data (which in this case is a single panel), and the correlation matrix:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boxes_matrix)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca03-1.png" width="2100" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(boxes_matrix)</span></code></pre></div>
<pre><code>##           long      diag
## long 1.0000000 0.9112586
## diag 0.9112586 1.0000000</code></pre>
<p>PCA using the <code>princomp()</code> function from the <code>stats</code> package. The <code>loadings()</code> function extracts the <em>loadings</em> or the correlations between the input variables and the new components, and the the <code>biplot()</code> function creates a <em>biplot</em> a single figure that plots the loadings as vectors and the <em>component scores</em> as points represented by the observation numbers.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>boxes_pca <span class="ot">&lt;-</span> <span class="fu">princomp</span>(boxes_matrix, <span class="at">cor=</span>T)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>boxes_pca</span></code></pre></div>
<pre><code>## Call:
## princomp(x = boxes_matrix, cor = T)
## 
## Standard deviations:
##   Comp.1   Comp.2 
## 1.382483 0.297895 
## 
##  2  variables and  25 observations.</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(boxes_pca)</span></code></pre></div>
<pre><code>## Importance of components:
##                           Comp.1    Comp.2
## Standard deviation     1.3824828 0.2978950
## Proportion of Variance 0.9556293 0.0443707
## Cumulative Proportion  0.9556293 1.0000000</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">loadings</span>(boxes_pca), <span class="at">cutoff=</span><span class="fl">0.0</span>)</span></code></pre></div>
<pre><code>## 
## Loadings:
##      Comp.1 Comp.2
## long  0.707  0.707
## diag  0.707 -0.707
## 
##                Comp.1 Comp.2
## SS loadings       1.0    1.0
## Proportion Var    0.5    0.5
## Cumulative Var    0.5    1.0</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(boxes_pca)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca04-1.png" width="2100" /></p>
<p>Note the angle between the vectors–the correlation between two variables is equal to the cosine of the angle between the vectors (<em>θ</em>), or <em>r = cos(θ)</em>. Here the angle is 24.3201359, which is found by the following R code: <code>acos(cor(boxes_matrix[,1],boxes_matrix[,2]))/((2*pi)/360)</code>.</p>
<p>The components can be drawn on the scatter plot as follows,</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get parameters of component lines (after Everitt &amp; Rabe-Hesketh)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>load <span class="ot">&lt;-</span>boxes_pca<span class="sc">$</span>loadings</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> load[<span class="dv">2</span>,]<span class="sc">/</span>load[<span class="dv">1</span>,]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> <span class="fu">apply</span>(boxes_matrix,<span class="dv">2</span>,mean)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>intcpt <span class="ot">&lt;-</span> mn[<span class="dv">2</span>]<span class="sc">-</span>(slope<span class="sc">*</span>mn[<span class="dv">1</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot with the two new axes added</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>) <span class="co"># square plotting frame</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">range</span>(boxes_matrix) <span class="co"># overall min, max</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boxes_matrix, <span class="at">xlim=</span>xlim, <span class="at">ylim=</span>xlim, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;purple&quot;</span>) <span class="co"># both axes same length</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(intcpt[<span class="dv">1</span>],slope[<span class="dv">1</span>],<span class="at">lwd=</span><span class="dv">2</span>) <span class="co"># first component solid line</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(intcpt[<span class="dv">2</span>],slope[<span class="dv">2</span>],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="co"># second component dashed</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;right&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;PC 1&quot;</span>, <span class="st">&quot;PC 2&quot;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># projections of points onto PCA 1</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> intcpt[<span class="dv">1</span>]<span class="sc">+</span>slope[<span class="dv">1</span>]<span class="sc">*</span>boxes_matrix[,<span class="dv">1</span>]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> (boxes_matrix[,<span class="dv">2</span>]<span class="sc">-</span>intcpt[<span class="dv">1</span>])<span class="sc">/</span>slope[<span class="dv">1</span>]</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> (y1<span class="sc">+</span>boxes_matrix[,<span class="dv">2</span>])<span class="sc">/</span><span class="fl">2.0</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> (x1<span class="sc">+</span>boxes_matrix[,<span class="dv">1</span>])<span class="sc">/</span><span class="fl">2.0</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(boxes_matrix[,<span class="dv">1</span>],boxes_matrix[,<span class="dv">2</span>], x2, y2, <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;purple&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca05-1.png" width="2100" /></p>
<p>This plot illustrates the idea of the first (or “principal” component) providing an optimal summary of the data–no other line drawn on this scatter plot would produce a set of projected values of the data points onto the line with less variance. The first component also has an application in reduced major axis (RMA) regression in which both x- and y-variables are assumed to have errors or uncertainties, or where there is no clear distinction between a predictor and a response.</p>
</div>
<div id="a-second-example-using-the-large-cites-data-set" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> A second example using the large-cites data set</h2>
<p>A second example of a simple PCA analysis can be illustrated using the large-cities data set <a href="https://pjbartlein.github.io/GeogDataAnalysis/data/csv/cities.csv">[cities.csv]</a></p>
<p>Create a data matrix that omits the city names and look at the data and the correlation matrix.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cities_matrix <span class="ot">&lt;-</span> <span class="fu">data.matrix</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cities_matrix) <span class="ot">&lt;-</span> cities[,<span class="dv">1</span>] <span class="co"># add city names as row labels</span></span></code></pre></div>
<div id="examining-the-correlation-matrix" class="section level3" number="3.2.1">
<h3 number="3.2.1"><span class="header-section-number">3.2.1</span> Examining the correlation matrix</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca06b-1.png" width="2100" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>])</span></code></pre></div>
<pre><code>##                Area   Pop.1980   Pop.1990   Pop.2000     Growth       Food   PersRoom      Water
## Area      1.0000000  0.1776504  0.1482707  0.0811688 -0.3106659 -0.2277181 -0.5172160  0.2941461
## Pop.1980  0.1776504  1.0000000  0.9559486  0.7919490 -0.6935458 -0.5209447 -0.5664580  0.6213565
## Pop.1990  0.1482707  0.9559486  1.0000000  0.9233506 -0.4888987 -0.4080286 -0.4612457  0.5995832
## Pop.2000  0.0811688  0.7919490  0.9233506  1.0000000 -0.1720913 -0.1386787 -0.1876411  0.4545814
## Growth   -0.3106659 -0.6935458 -0.4888987 -0.1720913  1.0000000  0.5607890  0.6711674 -0.5594034
## Food     -0.2277181 -0.5209447 -0.4080286 -0.1386787  0.5607890  1.0000000  0.6016164 -0.5047112
## PersRoom -0.5172160 -0.5664580 -0.4612457 -0.1876411  0.6711674  0.6016164  1.0000000 -0.6643779
## Water     0.2941461  0.6213565  0.5995832  0.4545814 -0.5594034 -0.5047112 -0.6643779  1.0000000
## Elec      0.2793523  0.4811426  0.4337657  0.2333170 -0.4730705 -0.6207611 -0.7934353  0.8304116
## Phones    0.1393848  0.6734610  0.5870475  0.3669274 -0.5402193 -0.8429700 -0.5926469  0.5512366
## Vehicles  0.4117518  0.4179417  0.4191265  0.2430040 -0.3214298 -0.7610807 -0.5537093  0.4163189
##                Elec     Phones   Vehicles
## Area      0.2793523  0.1393848  0.4117518
## Pop.1980  0.4811426  0.6734610  0.4179417
## Pop.1990  0.4337657  0.5870475  0.4191265
## Pop.2000  0.2333170  0.3669274  0.2430040
## Growth   -0.4730705 -0.5402193 -0.3214298
## Food     -0.6207611 -0.8429700 -0.7610807
## PersRoom -0.7934353 -0.5926469 -0.5537093
## Water     0.8304116  0.5512366  0.4163189
## Elec      1.0000000  0.5180646  0.5019066
## Phones    0.5180646  1.0000000  0.6303538
## Vehicles  0.5019066  0.6303538  1.0000000</code></pre>
<p>Matrix scatter plots, particularly those for a data set with a large number of variables are some times difficult to interpret. Two alternative plots are available: 1) a generalized depiction of the correlation matrix using the <code>corrplot()</code> function, and 2) a plot of the correlations as a network of links (“edges”) between variables (“nodes”) provided by the <code>qgraph()</code> function in the package of the same name.</p>
<p>The <code>corrplot()</code> function displays the correlation matrix using a set of little ellipses that provide a generalized dipiction of the strength and sign of a correlation.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code></pre></div>
<pre><code>## corrplot 0.84 loaded</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">cor</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>]), <span class="at">method=</span><span class="st">&quot;ellipse&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca07-1.png" width="2100" /></p>
<p>An alternative is simply fill each cell with an appropriate color and shade.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">cor</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>]), <span class="at">method=</span><span class="st">&quot;color&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca08-1.png" width="2100" /></p>
<p>Rectangular areas of similar sign and magnitude of the correlation identify groups of variables that tend to covary together across the observations. For example, the three population variables are postively correlated with one another, and are inversely correlated with <code>Growth</code>, <code>Food</code> and <code>PersRoom</code>.</p>
<p>Another way of depicting the correlations is as a network of line segments, which are drawn to illustrate the strength and sign of the correlations between each pair of variables. This plotting procedure uses the <code>qgraph</code> package for plotting networks, defined here by the correlations among variables (and later, among variables and components).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qgraph)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph</span>(<span class="fu">cor</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>]))</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca09-1.png" width="2100" /></p>
<p>Note that in the above plot, the variable names are abbreviated using just three characters. Most of the time this is enough.</p>
<p>A modification of the basic <code>qgraph()</code> plot involves arranging the nodes in a way that locates more highly correlated variables closer to one another (a “force-embedded” layout), specified by the <code>layout="spring"</code> argument. This approach uses the “Fruchterman-Reingold” algorithm that invokes the concept of spring tension pulling the nodes of the more highly correlated variables toward one another. The sign of the correlations are indicated by color: positive correlations are green, negative magenta (or red).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph</span>(<span class="fu">cor</span>(cities[,<span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>]), <span class="at">layout=</span><span class="st">&quot;spring&quot;</span>, <span class="at">shape=</span><span class="st">&quot;rectangle&quot;</span>, <span class="at">posCol=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol=</span><span class="st">&quot;darkmagenta&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca10-1.png" width="2100" /></p>
</div>
<div id="pca-of-the-cities-data" class="section level3" number="3.2.2">
<h3 number="3.2.2"><span class="header-section-number">3.2.2</span> PCA of the cities data</h3>
<p>Here’s the principal components analysis of the cities data:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cities_pca <span class="ot">&lt;-</span> <span class="fu">princomp</span>(cities_matrix, <span class="at">cor=</span>T)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cities_pca</span></code></pre></div>
<pre><code>## Call:
## princomp(x = cities_matrix, cor = T)
## 
## Standard deviations:
##     Comp.1     Comp.2     Comp.3     Comp.4     Comp.5     Comp.6     Comp.7     Comp.8     Comp.9 
## 2.46294201 1.31515696 1.00246883 0.92086602 0.83523273 0.50012846 0.48128911 0.35702153 0.17468753 
##    Comp.10    Comp.11 
## 0.10314352 0.05779932 
## 
##  11  variables and  21 observations.</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cities_pca)</span></code></pre></div>
<pre><code>## Importance of components:
##                           Comp.1    Comp.2     Comp.3     Comp.4     Comp.5     Comp.6     Comp.7
## Standard deviation     2.4629420 1.3151570 1.00246883 0.92086602 0.83523273 0.50012846 0.48128911
## Proportion of Variance 0.5514621 0.1572398 0.09135852 0.07709038 0.06341943 0.02273895 0.02105811
## Cumulative Proportion  0.5514621 0.7087019 0.80006045 0.87715083 0.94057026 0.96330921 0.98436732
##                            Comp.8      Comp.9      Comp.10      Comp.11
## Standard deviation     0.35702153 0.174687526 0.1031435150 0.0577993220
## Proportion of Variance 0.01158767 0.002774157 0.0009671441 0.0003037056
## Cumulative Proportion  0.99595499 0.998729150 0.9996962944 1.0000000000</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(cities_pca)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca11-1.png" width="2100" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loadings</span>(cities_pca)</span></code></pre></div>
<pre><code>## 
## Loadings:
##          Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7 Comp.8 Comp.9 Comp.10 Comp.11
## Area      0.160  0.299  0.603  0.569  0.141  0.326  0.131  0.195  0.106                
## Pop.1980  0.350 -0.340                0.248 -0.123         0.130  0.158  0.677  -0.428 
## Pop.1990  0.324 -0.445         0.104        -0.145                               0.804 
## Pop.2000  0.229 -0.586  0.109  0.228 -0.190                      -0.114 -0.571  -0.393 
## Growth   -0.295        -0.115  0.310 -0.682         0.388        -0.152  0.389         
## Food     -0.316 -0.263  0.456               -0.167        -0.574  0.502                
## PersRoom -0.332 -0.270 -0.241  0.116         0.544 -0.449  0.254  0.417                
## Water     0.330         0.229 -0.331 -0.357  0.533 -0.252 -0.376 -0.291  0.169         
## Elec      0.315  0.214  0.132 -0.345 -0.483 -0.183         0.414  0.517 -0.111         
## Phones    0.331        -0.447                0.364  0.571 -0.291  0.352                
## Vehicles  0.282  0.232 -0.272  0.519 -0.209 -0.288 -0.481 -0.372  0.152                
## 
##                Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7 Comp.8 Comp.9 Comp.10 Comp.11
## SS loadings     1.000  1.000  1.000  1.000  1.000  1.000  1.000  1.000  1.000   1.000   1.000
## Proportion Var  0.091  0.091  0.091  0.091  0.091  0.091  0.091  0.091  0.091   0.091   0.091
## Cumulative Var  0.091  0.182  0.273  0.364  0.455  0.545  0.636  0.727  0.818   0.909   1.000</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(cities_pca, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">cex=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.8</span>))</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca11-2.png" width="2100" /></p>
<p>In this case, there were two “important components” and a third that was pretty important, as evidenced by the break in slope of the “screeplot”. The biplot diplays both the <em>loadings</em> (correlations between the original variables and the components) as lablelled vectors, and the component <em>scores</em> as either symbols, or as here when the matrix has rownames, as labels.</p>
<p>The biplot and table of component loadings indicate that the first component includes variables that (more-or-less) trade off developed-world cities against developing-world ones. (Note the opposing directions of the vectors that are sub-parallel to the x-axis.) The second component (population) is noted by vectors and loadings that are (more-or-less) at right angles to the first set, and sub-parallel to the y-axis. (But note that the vector for <code>Pop.1980</code> is actually more parallel to the x-axis than the y.)</p>
<p>An alternative visualization of the principal component and their relationship with the original variables is provided by the <code>qgraph()</code> function. The original variables are indicted by three-character abbreviations, and the components by numbered nodes.</p>
<p>To implement this, it would be convenient to create a function that creates a <code>qgraph</code> loadings plot. This is done in two stages, the first creating a standard <code>qplot</code>, and the second applying the <code>layout = "spring"</code> argument. Here is the function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function for producing qgraphs of loadings</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>qgraph_loadings_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(loadings_in, title) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  ld <span class="ot">&lt;-</span> <span class="fu">loadings</span>(loadings_in)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  qg_pca <span class="ot">&lt;-</span> <span class="fu">qgraph</span>(ld, <span class="at">title=</span>title, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">attr</span>(ld, <span class="st">&quot;dimnames&quot;</span>)[[<span class="dv">1</span>]])</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qgraph</span>(qg_pca, <span class="at">title=</span>title,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">layout =</span> <span class="st">&quot;spring&quot;</span>, </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">node.height=</span><span class="fl">0.5</span>, <span class="at">node.width=</span><span class="fl">0.5</span>, <span class="at">vTrans=</span><span class="dv">255</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>, <span class="at">label.cex=</span><span class="fl">1.0</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The function has two arguments, a principle components object, from which loadings can be extracted, plus a title.</p>
<p>The <code>princomp()</code> function returns all <em>p</em> components, but the intial analysis suggests that only two, or possibly three components are meaningful. To manage the number of components that are “extracted” (as well as to implement other aspects of the analysis), we can use the <code>psych</code> package:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code></pre></div>
<p>The <code>qgraph</code> plot is then created by reextracting only two components in this case, and then sending the object created by te <code>principal()</code> function to the <code>qgraph_loadings_plot()</code> function we created above.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unrotated components</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cities_pca_unrot <span class="ot">&lt;-</span> <span class="fu">principal</span>(cities_matrix, <span class="at">nfactors=</span><span class="dv">2</span>, <span class="at">rotate=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>cities_pca_unrot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = cities_matrix, nfactors = 2, rotate = &quot;none&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##            PC1   PC2   h2    u2 com
## Area      0.39 -0.39 0.31 0.690 2.0
## Pop.1980  0.86  0.45 0.94 0.056 1.5
## Pop.1990  0.80  0.59 0.98 0.019 1.8
## Pop.2000  0.56  0.77 0.91 0.087 1.8
## Growth   -0.73  0.13 0.54 0.457 1.1
## Food     -0.78  0.35 0.73 0.273 1.4
## PersRoom -0.82  0.35 0.80 0.205 1.4
## Water     0.81 -0.01 0.66 0.341 1.0
## Elec      0.77 -0.28 0.68 0.320 1.3
## Phones    0.82 -0.05 0.67 0.332 1.0
## Vehicles  0.69 -0.30 0.57 0.426 1.4
## 
##                        PC1  PC2
## SS loadings           6.07 1.73
## Proportion Var        0.55 0.16
## Cumulative Var        0.55 0.71
## Proportion Explained  0.78 0.22
## Cumulative Proportion 0.78 1.00
## 
## Mean item complexity =  1.4
## Test of the hypothesis that 2 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.1 
##  with the empirical chi square  21.58  with prob &lt;  0.95 
## 
## Fit based upon off diagonal values = 0.97</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cities_pca_unrot)</span></code></pre></div>
<pre><code>## 
## Factor analysis with Call: principal(r = cities_matrix, nfactors = 2, rotate = &quot;none&quot;)
## 
## Test of the hypothesis that 2 factors are sufficient.
## The degrees of freedom for the model is 34  and the objective function was  6.87 
## The number of observations was  21  with Chi Square =  97.36  with prob &lt;  5e-08 
## 
## The root mean square of the residuals (RMSA) is  0.1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph_loadings_plot</span>(cities_pca_unrot, <span class="st">&quot;Unrotated component loadings&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca12-1.png" width="2100" /><img src="lec16_files/figure-html/pca12-2.png" width="2100" /></p>
<p>The first plot shows the two components in the middle and the original variables arranged in an ellipse or circle around the components. Positive loadings are shown in green, negative in magenta, with the magnitude of the loadings shown by the width of the network “edges”. The second plot uses the “spring” method to rearrange the plot so that the length of the edges and arrangement of components and variables reflects the magnitude of the loadings.</p>
</div>
</div>
<div id="rotation-of-principal-components" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> “Rotation” of principal components</h2>
<p>The interpretation of the components (which is governed by the loadings–the correlations of the original varialbles with the newly created components) can be enhanced by “rotation” which could be thought of a set of coordinated adjustments of the vectors on a biplot. There is not single optimal way of doing rotations, but probably the most common approach is “varimax” rotation in which the components are adjusted in a way that makes the loadings either high positive (or negative) or zero, while keeping the components uncorrelated or orthogonal. One side-product of rotation is that the first, or principal components is no longer optimal or the most efficient single-variable summary of the data set, but losing that property is often worth the incraese in interpretability. The <code>principal()</code> function in the <code>psych</code> package also implements rotation of principal components.</p>
<p>Note the location and linkages of <code>Pop.1980</code> in the plot.</p>
<p>Here’s the result with rotated components:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rotated components</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cities_pca_rot <span class="ot">&lt;-</span> <span class="fu">principal</span>(cities_matrix, <span class="at">nfactors=</span><span class="dv">2</span>, <span class="at">rotate=</span><span class="st">&quot;varimax&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>cities_pca_rot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = cities_matrix, nfactors = 2, rotate = &quot;varimax&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##            RC1   RC2   h2    u2 com
## Area      0.55 -0.07 0.31 0.690 1.0
## Pop.1980  0.41  0.88 0.94 0.056 1.4
## Pop.1990  0.28  0.95 0.98 0.019 1.2
## Pop.2000 -0.02  0.96 0.91 0.087 1.0
## Growth   -0.65 -0.34 0.54 0.457 1.5
## Food     -0.83 -0.20 0.73 0.273 1.1
## PersRoom -0.87 -0.22 0.80 0.205 1.1
## Water     0.65  0.49 0.66 0.341 1.9
## Elec      0.79  0.25 0.68 0.320 1.2
## Phones    0.68  0.45 0.67 0.332 1.7
## Vehicles  0.74  0.18 0.57 0.426 1.1
## 
##                        RC1  RC2
## SS loadings           4.46 3.33
## Proportion Var        0.41 0.30
## Cumulative Var        0.41 0.71
## Proportion Explained  0.57 0.43
## Cumulative Proportion 0.57 1.00
## 
## Mean item complexity =  1.3
## Test of the hypothesis that 2 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.1 
##  with the empirical chi square  21.58  with prob &lt;  0.95 
## 
## Fit based upon off diagonal values = 0.97</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cities_pca_rot)</span></code></pre></div>
<pre><code>## 
## Factor analysis with Call: principal(r = cities_matrix, nfactors = 2, rotate = &quot;varimax&quot;)
## 
## Test of the hypothesis that 2 factors are sufficient.
## The degrees of freedom for the model is 34  and the objective function was  6.87 
## The number of observations was  21  with Chi Square =  97.36  with prob &lt;  5e-08 
## 
## The root mean square of the residuals (RMSA) is  0.1</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot.psych</span>(cities_pca_rot, <span class="at">labels=</span><span class="fu">rownames</span>(cities_matrix), <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">cex=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.8</span>),</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim.s=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="at">ylim.s=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">4</span>))</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca16-1.png" width="2100" /> … and the <code>qgraph()</code> plot of the rotated-component results:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph_loadings_plot</span>(cities_pca_rot, <span class="st">&quot;Rotated component loadings&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/pca17-1.png" width="2100" /><img src="lec16_files/figure-html/pca17-2.png" width="2100" /></p>
<p>Notice that now all three population variables are now “most highly loaded on” the second component.</p>
<p><a href="lec16.html">[Back to top]</a></p>
</div>
</div>
<div id="factor-analyis-fa-and-pca" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Factor analyis (FA) and PCA</h1>
<p><em>Factor analysis (FA)</em> can be thought of as a parallel analysis to PCA, and in some ways PCA and be viewed as a special case of FA. Despite their names being used indiscriminantly, the two alaysis do have differing underlying models:</p>
<ul>
<li>PCA: maximum variance, maximum simultaneous resemblance motivations</li>
<li>Factor Analysis: variables are assembled from two major components common “factors” and “unique” factors, e.g.  <strong>X</strong> = <strong>m</strong> + <strong>Lf</strong> + <strong>u</strong>, where <strong>X</strong> is a maxrix of data, <strong>m</strong> is the (vector) mean of the variables, <strong>L</strong> is a <em>p</em> x <em>k</em> matrix of factor loadings <strong>f</strong> and <strong>u</strong> are random vectors representing the underlying common and unique factors.</li>
</ul>
<p>The model underlying factor analysis is:</p>
<p><em>data = common factors + unique factors</em></p>
<p>The common factors in factor analysis are much like the first few principal components, and are often defined that way in initial phases of the analysis.</p>
<p>The practical difference between the two analyses now lies mainly in the decision whether to rotate the principal components to emphasize the “simple structure” of the component loadings:</p>
<ul>
<li>easier interpretation</li>
<li>in geographical data: regionalization</li>
</ul>
<div id="example-of-a-factor-analysis" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Example of a factor analysis</h2>
<p>Here’s a factor analysis of the large-cities data set using the <code>factanal()</code> function:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cities_fa1 -- factor analysis of cities data -- no rotation</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cities_fa1 <span class="ot">&lt;-</span> <span class="fu">factanal</span>(cities_matrix, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">&quot;none&quot;</span>, <span class="at">scores=</span><span class="st">&quot;regression&quot;</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>cities_fa1</span></code></pre></div>
<pre><code>## 
## Call:
## factanal(x = cities_matrix, factors = 2, scores = &quot;regression&quot;,     rotation = &quot;none&quot;)
## 
## Uniquenesses:
##     Area Pop.1980 Pop.1990 Pop.2000   Growth     Food PersRoom    Water     Elec   Phones Vehicles 
##    0.933    0.022    0.005    0.005    0.179    0.437    0.387    0.541    0.605    0.426    0.706 
## 
## Loadings:
##          Factor1 Factor2
## Area      0.129   0.225 
## Pop.1980  0.914   0.377 
## Pop.1990  0.988   0.136 
## Pop.2000  0.967  -0.243 
## Growth   -0.386  -0.820 
## Food     -0.316  -0.681 
## PersRoom -0.368  -0.691 
## Water     0.558   0.384 
## Elec      0.366   0.510 
## Phones    0.518   0.553 
## Vehicles  0.356   0.409 
## 
##                Factor1 Factor2
## SS loadings      3.989   2.766
## Proportion Var   0.363   0.251
## Cumulative Var   0.363   0.614
## 
## Test of the hypothesis that 2 factors are sufficient.
## The chi square statistic is 83.44 on 34 degrees of freedom.
## The p-value is 4.86e-06</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(cities_fa1<span class="sc">$</span>scores[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="fu">loadings</span>(cities_fa1), <span class="at">cex=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.8</span>))</span></code></pre></div>
<p><img src="lec16_files/figure-html/fa02-1.png" width="2100" /></p>
<p>Notice that the biplot looks much the same as that for PCA (as to the loadings, which have the same interpretation–as correlations between the factors and the original variables). A new element of the factor analysis output is the “Uniquenesses” table, which, as it says, describes the uniqueness of individual variables, where values near 1.0 indicate variables that are tending to measure unique properties in the data set, while values near 0.0 indicate variables that are duplicated in a sense by other variables in the data set.</p>
<p>Here’s the <code>qgraph</code> plot:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph_loadings_plot</span>(cities_fa1, <span class="st">&quot;Factor analysis&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/fa03-1.png" width="2100" /><img src="lec16_files/figure-html/fa03-2.png" width="2100" /></p>
<p>Note the “external” line segments that are scaled to the uniqueness values of each variable, and represent sources of variability extraneous to (or outside of) that generated by the factors.</p>
<p>Here is a “rotated” factor analysis:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cities_fa2 -- factor analysis of cities data -- varimax rotation</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cities_fa2 <span class="ot">&lt;-</span> <span class="fu">factanal</span>(cities_matrix, <span class="at">factors=</span><span class="dv">2</span>, <span class="at">rotation=</span><span class="st">&quot;varimax&quot;</span>, <span class="at">scores=</span><span class="st">&quot;regression&quot;</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>cities_fa2</span></code></pre></div>
<pre><code>## 
## Call:
## factanal(x = cities_matrix, factors = 2, scores = &quot;regression&quot;,     rotation = &quot;varimax&quot;)
## 
## Uniquenesses:
##     Area Pop.1980 Pop.1990 Pop.2000   Growth     Food PersRoom    Water     Elec   Phones Vehicles 
##    0.933    0.022    0.005    0.005    0.179    0.437    0.387    0.541    0.605    0.426    0.706 
## 
## Loadings:
##          Factor1 Factor2
## Area      0.251         
## Pop.1980  0.602   0.784 
## Pop.1990  0.389   0.919 
## Pop.2000          0.997 
## Growth   -0.892  -0.159 
## Food     -0.740  -0.127 
## PersRoom -0.763  -0.175 
## Water     0.516   0.439 
## Elec      0.588   0.221 
## Phones    0.669   0.356 
## Vehicles  0.488   0.237 
## 
##                Factor1 Factor2
## SS loadings      3.801   2.954
## Proportion Var   0.346   0.269
## Cumulative Var   0.346   0.614
## 
## Test of the hypothesis that 2 factors are sufficient.
## The chi square statistic is 83.44 on 34 degrees of freedom.
## The p-value is 4.86e-06</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(cities_fa2<span class="sc">$</span>scores[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="fu">loadings</span>(cities_fa2), <span class="at">cex=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.8</span>))</span></code></pre></div>
<p><img src="lec16_files/figure-html/fa04-1.png" width="2100" /></p>
<p>… and the <code>qgraph</code> plot:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qgraph)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph_loadings_plot</span>(cities_fa2, <span class="st">&quot;Factor analysis -- rotated factors&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/fa05-1.png" width="2100" /><img src="lec16_files/figure-html/fa05-2.png" width="2100" /></p>
<p><a href="lec16.html">[Back to top]</a></p>
</div>
</div>
<div id="a-second-example-controls-of-mid-holocene-aridity-in-eurasia" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> A second example: Controls of mid-Holocene aridity in Eurasia</h1>
<p>The data set here is a “stacked” data set of output from thirteen “PMIP3” simulations of mid-Holocene climate (in particular, the long-term mean differences between the mid-Holocene simulations and those for the pre-industrial period) for a region in northern Eurasia. The objective of the analysis was to examine the systematic relationship among a number of different climate variables as part of understanding the mismatch between the simulations and paleoenvironmental observations (reconstructions), where the simulations were in general drier and warmer than the climate reconstructed from the data. (See Bartlein, P.J., S.P. Harrison and K. Izumi, 2017, Underlying causes of Eurasian mid-continental aridity in simulations of mid-Holocene climate, <em>Geophysical Research Letters</em> 44:1-9, <a href="http://dx.doi.org/10.1002/2017GL074476">http://dx.doi.org/10.1002/2017GL074476</a>)</p>
<p>The variables include:</p>
<ul>
<li><code>Kext</code>: Insolation at the top of the atmosphere</li>
<li><code>Kn</code>: Net shortwave radiation</li>
<li><code>Ln</code>: Net longwave ratiation<br />
</li>
<li><code>Qn</code>: Net radiation</li>
<li><code>Qe</code>: Latent heating</li>
<li><code>Qh</code>: Sensible heating</li>
<li><code>Qg</code>: Substrate heating</li>
<li><code>bowen</code>: Bowen ratio (<code>Qh/Qn</code>)</li>
<li><code>alb</code>: Albedo</li>
<li><code>ta</code>: 850 mb temperature</li>
<li><code>tas</code>: Near-surface (2 m) air temperature</li>
<li><code>ts</code>: Surface (skin) temperature</li>
<li><code>ua</code>: Eastward wind component, 500 hPa level</li>
<li><code>va</code>: Northward wind component, 500 hPa level</li>
<li><code>omg</code>: 500 hPa vertical velocity</li>
<li><code>uas</code>: Eastward wind component, surface</li>
<li><code>vas</code>: Northward wind component, surface</li>
<li><code>slp</code>: Mean sea-level pressure</li>
<li><code>Qdv</code>: Moisture divergence</li>
<li><code>shm</code>: Specific humidity</li>
<li><code>clt</code>: Cloudiness</li>
<li><code>pre</code>: Precipitation rate</li>
<li><code>evap</code>: Evaporation rate</li>
<li><code>pme</code>: P-E rate</li>
<li><code>sm</code>: Soil moisture</li>
<li><code>ro</code>: Runoff</li>
<li><code>dS</code>: Change in moisture storage</li>
<li><code>snd</code>: Snow depth</li>
</ul>
<p>The data set was assebled by stacking the monthly long-term mean differneces from each model on top of one another, creating a 13 x 12 row by 24 column array. This arrangement of the data will reveal the common variations in the seasonal cycles of the long-term mean differences.</p>
<div id="read-and-transform-the-data" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Read and transform the data</h2>
<p>Load necessary packages.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pca of multimodel means</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qgraph)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code></pre></div>
<p>Read the data:</p>
<pre><code>##  [1] &quot;Kext&quot;  &quot;Kn&quot;    &quot;Ln&quot;    &quot;Qn&quot;    &quot;Qe&quot;    &quot;Qh&quot;    &quot;Qg&quot;    &quot;bowen&quot; &quot;alb&quot;   &quot;ta&quot;    &quot;tas&quot;   &quot;ts&quot;   
## [13] &quot;ua&quot;    &quot;va&quot;    &quot;omg&quot;   &quot;uas&quot;   &quot;vas&quot;   &quot;slp&quot;   &quot;Qdv&quot;   &quot;shm&quot;   &quot;clt&quot;   &quot;pre&quot;   &quot;evap&quot;  &quot;pme&quot;  
## [25] &quot;sm&quot;    &quot;ro&quot;    &quot;dS&quot;    &quot;snd&quot;</code></pre>
<pre><code>##       Kext                Kn                 Ln                  Qn                 Qe         
##  Min.   :-13.6300   Min.   :-14.1700   Min.   :-6.001000   Min.   :-13.9000   Min.   :-8.0500  
##  1st Qu.:-10.4225   1st Qu.: -5.5927   1st Qu.:-1.111500   1st Qu.: -4.0630   1st Qu.:-1.1265  
##  Median : -6.4320   Median : -2.4285   Median : 0.299050   Median : -1.7405   Median :-0.5851  
##  Mean   :  0.3369   Mean   :  0.4261   Mean   :-0.005344   Mean   :  0.4208   Mean   :-0.1175  
##  3rd Qu.:  7.7847   3rd Qu.:  3.9592   3rd Qu.: 1.561250   3rd Qu.:  3.1260   3rd Qu.: 0.4831  
##  Max.   : 27.9600   Max.   : 18.0700   Max.   : 3.333000   Max.   : 16.1200   Max.   : 7.9230  
##                                                                                                
##        Qh                Qg              bowen                 alb                  ta         
##  Min.   :-5.1570   Min.   :-5.0070   Min.   :-9.870e+04   Min.   :-0.780800   Min.   :-2.2300  
##  1st Qu.:-1.9760   1st Qu.:-0.9643   1st Qu.: 0.000e+00   1st Qu.:-0.001757   1st Qu.:-0.7361  
##  Median :-0.8945   Median :-0.2530   Median : 0.000e+00   Median : 0.356050   Median :-0.3137  
##  Mean   : 0.3968   Mean   : 0.1404   Mean   : 2.826e+13   Mean   : 0.705529   Mean   : 0.1110  
##  3rd Qu.: 2.0897   3rd Qu.: 1.3645   3rd Qu.: 1.000e+00   3rd Qu.: 1.113250   3rd Qu.: 0.8729  
##  Max.   :12.0900   Max.   : 6.3150   Max.   : 2.650e+15   Max.   : 6.185000   Max.   : 3.1420  
##                                                                                                
##       tas                 ts                 ua                 va                 omg            
##  Min.   :-2.76900   Min.   :-2.88700   Min.   :-0.98680   Min.   :-0.495200   Min.   :-3.320e-03  
##  1st Qu.:-0.92268   1st Qu.:-0.96540   1st Qu.:-0.35147   1st Qu.:-0.134500   1st Qu.:-6.360e-04  
##  Median :-0.42775   Median :-0.43625   Median :-0.09715   Median :-0.003020   Median :-9.845e-05  
##  Mean   :-0.02964   Mean   :-0.02853   Mean   :-0.07626   Mean   : 0.002278   Mean   :-1.757e-04  
##  3rd Qu.: 0.82620   3rd Qu.: 0.82827   3rd Qu.: 0.15207   3rd Qu.: 0.126825   3rd Qu.: 2.918e-04  
##  Max.   : 3.14600   Max.   : 3.34300   Max.   : 1.22400   Max.   : 0.492300   Max.   : 1.370e-03  
##                                                                                                   
##       uas                 vas                slp               Qdv                  shm            
##  Min.   :-0.375000   Min.   :-0.13690   Min.   :-358.90   Min.   :-5.390e-10   Min.   :-5.020e-04  
##  1st Qu.:-0.104800   1st Qu.:-0.03717   1st Qu.:-114.83   1st Qu.:-5.603e-11   1st Qu.:-9.333e-05  
##  Median :-0.022700   Median : 0.02635   Median : -11.97   Median :-1.990e-11   Median :-2.340e-05  
##  Mean   :-0.008201   Mean   : 0.02238   Mean   : -48.91   Mean   :-1.825e-11   Mean   : 6.629e-05  
##  3rd Qu.: 0.092525   3rd Qu.: 0.07550   3rd Qu.:  45.24   3rd Qu.: 3.635e-11   3rd Qu.: 1.655e-04  
##  Max.   : 0.591500   Max.   : 0.22940   Max.   : 126.30   Max.   : 2.030e-10   Max.   : 9.930e-04  
##                                                                                                    
##       clt               pre                 evap                pme                 sm         
##  Min.   :-5.8260   Min.   :-0.266700   Min.   :-0.278200   Min.   :-0.26930   Min.   :-40.330  
##  1st Qu.:-0.8750   1st Qu.:-0.037850   1st Qu.:-0.037825   1st Qu.:-0.04333   1st Qu.:-11.960  
##  Median : 0.2599   Median :-0.000015   Median :-0.016950   Median : 0.00441   Median : -5.433  
##  Mean   :-0.1085   Mean   :-0.012835   Mean   :-0.001746   Mean   :-0.01109   Mean   : -9.501  
##  3rd Qu.: 1.0036   3rd Qu.: 0.023350   3rd Qu.: 0.016725   3rd Qu.: 0.03058   3rd Qu.: -3.272  
##  Max.   : 2.4320   Max.   : 0.104900   Max.   : 0.273700   Max.   : 0.10930   Max.   :  7.799  
##                                                                                                
##        ro                  dS                 snd            
##  Min.   :-0.288000   Min.   :-0.424700   Min.   :-0.0056800  
##  1st Qu.:-0.020650   1st Qu.:-0.052750   1st Qu.:-0.0000117  
##  Median :-0.006690   Median : 0.012300   Median : 0.0054200  
##  Mean   :-0.008101   Mean   :-0.006516   Mean   : 0.0094521  
##  3rd Qu.: 0.000247   3rd Qu.: 0.044000   3rd Qu.: 0.0156750  
##  Max.   : 0.439200   Max.   : 0.262900   Max.   : 0.0593000  
##                                          NA&#39;s   :2</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>datapath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Documents/geog495/data/csv/&quot;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>csvfile <span class="ot">&lt;-</span> <span class="st">&quot;aavesModels_ltmdiff_NEurAsia.csv&quot;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>input_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(datapath, csvfile, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>mm_data_in <span class="ot">&lt;-</span> input_data[,<span class="dv">3</span><span class="sc">:</span><span class="dv">30</span>]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mm_data_in)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mm_data_in)</span></code></pre></div>
<p>There are a few fix-ups to do. Recode a few missing (NA) values of snow depth to 0.0:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recode a few NA&#39;s to zero</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>mm_data_in<span class="sc">$</span>snd[<span class="fu">is.na</span>(mm_data_in<span class="sc">$</span>snd)] <span class="ot">&lt;-</span> <span class="fl">0.0</span></span></code></pre></div>
<p>Remove some uncessary or redundant variable:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove uneccesary variables</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>dropvars <span class="ot">&lt;-</span> <span class="fu">names</span>(mm_data_in) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Kext&quot;</span>,<span class="st">&quot;bowen&quot;</span>,<span class="st">&quot;sm&quot;</span>,<span class="st">&quot;evap&quot;</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>mm_data <span class="ot">&lt;-</span> mm_data_in[<span class="sc">!</span>dropvars]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mm_data)</span></code></pre></div>
<pre><code>##  [1] &quot;Kn&quot;  &quot;Ln&quot;  &quot;Qn&quot;  &quot;Qe&quot;  &quot;Qh&quot;  &quot;Qg&quot;  &quot;alb&quot; &quot;ta&quot;  &quot;tas&quot; &quot;ts&quot;  &quot;ua&quot;  &quot;va&quot;  &quot;omg&quot; &quot;uas&quot; &quot;vas&quot; &quot;slp&quot;
## [17] &quot;Qdv&quot; &quot;shm&quot; &quot;clt&quot; &quot;pre&quot; &quot;pme&quot; &quot;ro&quot;  &quot;dS&quot;  &quot;snd&quot;</code></pre>
</div>
<div id="correlations-among-variables" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Correlations among variables</h2>
<p>It’s useful to look at the correlations among the long-term mean differences among the variables. This could be done using a matrix scatterplot (<code>plot(mm_data, pch=16, cex=0.5</code>), but there are enough variables (24) to make that difficult to interpret. Another approach is to look at a <code>corrplot()</code> image:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>cor_mm_data <span class="ot">&lt;-</span> <span class="fu">cor</span>(mm_data)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_mm_data, <span class="at">method=</span><span class="st">&quot;color&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/unnamed-chunk-7-1.png" width="2100" /></p>
<p>The plaid-like appearance of the plot suggests that there are several groups of variables whose variations of long-term mean differences throughout the year are similar.</p>
<p>The correlations can also be illustrated by plotting the correlations as a network graph using the <code>qgraph()</code> function, with the strength of the correlations indicated by the width of the lines (or “edges”), and the sign by the color (green = positive and magenta = negative).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph</span>(cor_mm_data, <span class="at">title=</span><span class="st">&quot;Correlations, multi-model ltm differences over months&quot;</span>,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># layout = &quot;spring&quot;, </span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">node.height=</span><span class="fl">0.5</span>, <span class="at">node.width=</span><span class="fl">0.5</span>, <span class="at">vTrans=</span><span class="dv">255</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>, <span class="at">label.cex=</span><span class="fl">1.0</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span> ) </span></code></pre></div>
<p><img src="lec16_files/figure-html/unnamed-chunk-8-1.png" width="2100" /></p>
<p>A useful variant of this plot is provided by using the strength of the correlations to arrange the nodes (i.e. the variables). This is done by using the “Fruchterman-Reingold” algorithm that invokes the concept of spring tension pulling the nodes of the more highly correlated variables toward one another.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph</span>(cor_mm_data, <span class="at">title=</span><span class="st">&quot;Correlations, multi-model ltm differences over months&quot;</span>,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">layout =</span> <span class="st">&quot;spring&quot;</span>, <span class="at">repulsion =</span> <span class="fl">0.75</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">node.height=</span><span class="fl">0.5</span>, <span class="at">node.width=</span><span class="fl">0.5</span>, <span class="at">vTrans=</span><span class="dv">255</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>, <span class="at">label.cex=</span><span class="fl">1.0</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span> ) </span></code></pre></div>
<p><img src="lec16_files/figure-html/unnamed-chunk-9-1.png" width="2100" /></p>
<p>We can already see that there are groups of variables that are highly correlated with one another. For example the three temperatures variables (<code>tas</code> (2-m air temperature), <code>ts</code> (surface or “skin” temperature), <code>ta</code> (850mb temperature)), are plotted close to one another, as are some of the surface energy-balance variables (e.g. <code>Qn</code> and <code>Kn</code>, net radiation and net shortwave radiation).</p>
</div>
<div id="pca-of-the-pmip-3-data" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> PCA of the PMIP 3 data</h2>
<p>Do a principal components analysis of the long-term mean differneces using the <code>principal()</code> function from the <code>psych</code> package. Initially, extract eight components:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>nfactors <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>mm_pca_unrot <span class="ot">&lt;-</span> <span class="fu">principal</span>(mm_data, <span class="at">nfactors =</span> nfactors, <span class="at">rotate =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>mm_pca_unrot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = mm_data, nfactors = nfactors, rotate = &quot;none&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##       PC1   PC2   PC3   PC4   PC5   PC6   PC7   PC8   h2    u2 com
## Kn   0.95 -0.09  0.02 -0.19  0.00  0.12  0.00 -0.14 0.99 0.013 1.2
## Ln  -0.79  0.36  0.16  0.09 -0.25  0.02 -0.06  0.21 0.91 0.090 2.0
## Qn   0.94  0.01  0.08 -0.21 -0.08  0.16 -0.02 -0.11 0.98 0.018 1.2
## Qe   0.68  0.44  0.02 -0.03 -0.33  0.44  0.04  0.10 0.97 0.034 3.1
## Qh   0.91 -0.18 -0.04 -0.18  0.08  0.02 -0.05 -0.18 0.94 0.060 1.3
## Qg   0.69 -0.18  0.35 -0.31 -0.04 -0.01 -0.03 -0.15 0.76 0.241 2.2
## alb -0.64 -0.30 -0.32 -0.38  0.09  0.15 -0.03  0.30 0.87 0.126 3.5
## ta   0.91  0.23 -0.13  0.12  0.07 -0.14  0.05  0.08 0.95 0.049 1.3
## tas  0.93  0.23 -0.09  0.12  0.07 -0.10  0.04  0.05 0.96 0.043 1.2
## ts   0.93  0.22 -0.09  0.11  0.08 -0.10  0.04  0.04 0.96 0.043 1.2
## ua  -0.26  0.39  0.06  0.10  0.71  0.31 -0.19  0.11 0.88 0.123 2.6
## va   0.73  0.30 -0.06  0.02  0.19 -0.30  0.00  0.07 0.75 0.250 1.9
## omg  0.27 -0.50  0.02  0.53 -0.20 -0.07  0.22  0.24 0.75 0.252 3.7
## uas -0.74  0.09  0.05 -0.06  0.15  0.36  0.42 -0.22 0.94 0.064 2.5
## vas -0.67  0.37 -0.03  0.03  0.13 -0.04  0.57 -0.05 0.93 0.072 2.7
## slp -0.89 -0.14  0.12  0.17 -0.22 -0.05 -0.01 -0.04 0.92 0.083 1.3
## Qdv  0.01 -0.39  0.00  0.70  0.11  0.37 -0.24 -0.11 0.86 0.138 2.6
## shm  0.79  0.37 -0.19  0.08 -0.08  0.06  0.07  0.30 0.92 0.083 2.0
## clt -0.65  0.30  0.44 -0.06 -0.24 -0.05 -0.18 -0.14 0.82 0.179 3.0
## pre  0.02  0.89  0.18  0.02 -0.21  0.20 -0.11  0.06 0.92 0.081 1.4
## pme -0.78  0.38  0.15  0.05  0.19 -0.30 -0.14 -0.04 0.92 0.077 2.2
## ro   0.10 -0.16  0.89 -0.04  0.21 -0.09  0.07  0.25 0.96 0.040 1.4
## dS  -0.65  0.38 -0.55  0.07 -0.04 -0.16 -0.13 -0.20 0.96 0.035 3.1
## snd -0.67 -0.28 -0.25 -0.41 -0.02  0.09 -0.10  0.30 0.86 0.141 3.0
## 
##                         PC1  PC2  PC3  PC4  PC5  PC6  PC7  PC8
## SS loadings           12.18 2.85 1.76 1.40 1.09 0.94 0.76 0.68
## Proportion Var         0.51 0.12 0.07 0.06 0.05 0.04 0.03 0.03
## Cumulative Var         0.51 0.63 0.70 0.76 0.80 0.84 0.87 0.90
## Proportion Explained   0.56 0.13 0.08 0.06 0.05 0.04 0.04 0.03
## Cumulative Proportion  0.56 0.69 0.78 0.84 0.89 0.93 0.97 1.00
## 
## Mean item complexity =  2.1
## Test of the hypothesis that 8 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.03 
##  with the empirical chi square  69.66  with prob &lt;  1 
## 
## Fit based upon off diagonal values = 1</code></pre>
<p>The analysis suggests that only five components are as “important” as any of the original (standardized) variables, so repeate the analysis extracting just five components:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>nfactors <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>mm_pca_unrot <span class="ot">&lt;-</span> <span class="fu">principal</span>(mm_data, <span class="at">nfactors =</span> nfactors, <span class="at">rotate =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>mm_pca_unrot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = mm_data, nfactors = nfactors, rotate = &quot;none&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##       PC1   PC2   PC3   PC4   PC5   h2    u2 com
## Kn   0.95 -0.09  0.02 -0.19  0.00 0.95 0.048 1.1
## Ln  -0.79  0.36  0.16  0.09 -0.25 0.86 0.137 1.8
## Qn   0.94  0.01  0.08 -0.21 -0.08 0.94 0.056 1.1
## Qe   0.68  0.44  0.02 -0.03 -0.33 0.76 0.237 2.2
## Qh   0.91 -0.18 -0.04 -0.18  0.08 0.91 0.094 1.2
## Qg   0.69 -0.18  0.35 -0.31 -0.04 0.73 0.266 2.1
## alb -0.64 -0.30 -0.32 -0.38  0.09 0.76 0.244 2.7
## ta   0.91  0.23 -0.13  0.12  0.07 0.92 0.077 1.2
## tas  0.93  0.23 -0.09  0.12  0.07 0.94 0.058 1.2
## ts   0.93  0.22 -0.09  0.11  0.08 0.94 0.057 1.2
## ua  -0.26  0.39  0.06  0.10  0.71 0.74 0.264 1.9
## va   0.73  0.30 -0.06  0.02  0.19 0.66 0.344 1.5
## omg  0.27 -0.50  0.02  0.53 -0.20 0.64 0.359 2.8
## uas -0.74  0.09  0.05 -0.06  0.15 0.58 0.423 1.1
## vas -0.67  0.37 -0.03  0.03  0.13 0.60 0.403 1.7
## slp -0.89 -0.14  0.12  0.17 -0.22 0.91 0.086 1.3
## Qdv  0.01 -0.39  0.00  0.70  0.11 0.65 0.348 1.6
## shm  0.79  0.37 -0.19  0.08 -0.08 0.82 0.179 1.6
## clt -0.65  0.30  0.44 -0.06 -0.24 0.77 0.234 2.6
## pre  0.02  0.89  0.18  0.02 -0.21 0.86 0.137 1.2
## pme -0.78  0.38  0.15  0.05  0.19 0.81 0.190 1.7
## ro   0.10 -0.16  0.89 -0.04  0.21 0.88 0.118 1.2
## dS  -0.65  0.38 -0.55  0.07 -0.04 0.88 0.118 2.6
## snd -0.67 -0.28 -0.25 -0.41 -0.02 0.75 0.246 2.4
## 
##                         PC1  PC2  PC3  PC4  PC5
## SS loadings           12.18 2.85 1.76 1.40 1.09
## Proportion Var         0.51 0.12 0.07 0.06 0.05
## Cumulative Var         0.51 0.63 0.70 0.76 0.80
## Proportion Explained   0.63 0.15 0.09 0.07 0.06
## Cumulative Proportion  0.63 0.78 0.87 0.94 1.00
## 
## Mean item complexity =  1.7
## Test of the hypothesis that 5 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.05 
##  with the empirical chi square  231.12  with prob &lt;  0.00063 
## 
## Fit based upon off diagonal values = 0.99</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loadings</span>(mm_pca_unrot)</span></code></pre></div>
<pre><code>## 
## Loadings:
##     PC1    PC2    PC3    PC4    PC5   
## Kn   0.953               -0.187       
## Ln  -0.795  0.365  0.160        -0.253
## Qn   0.943               -0.205       
## Qe   0.679  0.440               -0.326
## Qh   0.912 -0.180        -0.184       
## Qg   0.695 -0.177  0.349 -0.311       
## alb -0.645 -0.297 -0.317 -0.378       
## ta   0.914  0.228 -0.126  0.123       
## tas  0.927  0.232         0.118       
## ts   0.933  0.216         0.108       
## ua  -0.262  0.389                0.710
## va   0.725  0.299                0.190
## omg  0.274 -0.496         0.527 -0.204
## uas -0.736                       0.148
## vas -0.666  0.366                0.134
## slp -0.894 -0.145  0.116  0.174 -0.223
## Qdv        -0.392         0.698  0.110
## shm  0.794  0.374 -0.190              
## clt -0.648  0.302  0.439        -0.242
## pre         0.887  0.176        -0.211
## pme -0.777  0.382  0.149         0.188
## ro         -0.164  0.893         0.215
## dS  -0.654  0.379 -0.551              
## snd -0.669 -0.275 -0.253 -0.406       
## 
##                   PC1   PC2   PC3   PC4   PC5
## SS loadings    12.180 2.852 1.763 1.395 1.085
## Proportion Var  0.507 0.119 0.073 0.058 0.045
## Cumulative Var  0.507 0.626 0.700 0.758 0.803</code></pre>
<p>This result could also be confirmed by looking at the “scree plot”:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scree</span>(mm_data, <span class="at">fa =</span> <span class="cn">FALSE</span>, <span class="at">pc =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/unnamed-chunk-12-1.png" width="2100" /></p>
</div>
<div id="qgraph-plot-of-the-principal-components" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> qgraph plot of the principal components</h2>
<p>The first plot below shows the components as square nodes, and the orignal variables as circular nodes. The second modifies that first plot by applying the “spring” layout.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph_loadings_plot</span>(mm_pca_unrot, <span class="at">title=</span><span class="st">&quot;Unrotated component loadings, all models over all months&quot;</span>)</span></code></pre></div>
<p><img src="lec16_files/figure-html/unnamed-chunk-13-1.png" width="2100" /><img src="lec16_files/figure-html/unnamed-chunk-13-2.png" width="2100" /></p>
<p>This result suggests (as also does the scree plot) that there is one very important (i.e. “principal” component) that is highly correlated with (or “loads heavily on”) a number of variables, with subsequent components correlated with mainly with a single variable.</p>
</div>
<div id="rotated-components" class="section level2" number="5.5">
<h2 number="5.5"><span class="header-section-number">5.5</span> Rotated components</h2>
<p>The interpretability of the componets can often be improved by “rotation” of the components, which amounts to slightly moving the PCA axes relative to the original variable axes, while still maintaining the orthogonality (or “uncorrelatedness”) of the components. This has the effect of reducing the importance of the first component(s) (because the adjusted axes are no longer optimal), but this trade-off is usually worth it.</p>
<p>Here are the results:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>nfactors <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>mm_pca_rot <span class="ot">&lt;-</span> <span class="fu">principal</span>(mm_data, <span class="at">nfactors =</span> nfactors, <span class="at">rotate =</span> <span class="st">&quot;varimax&quot;</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>mm_pca_rot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = mm_data, nfactors = nfactors, rotate = &quot;varimax&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##       RC1   RC2   RC3   RC4   h2    u2 com
## Kn   0.67 -0.67  0.22  0.10 0.95 0.048 2.2
## Ln  -0.42  0.78 -0.04  0.09 0.80 0.201 1.6
## Qn   0.71 -0.58  0.26  0.15 0.94 0.062 2.3
## Qe   0.78 -0.08  0.07  0.19 0.66 0.344 1.2
## Qh   0.59 -0.72  0.15  0.06 0.90 0.100 2.1
## Qg   0.38 -0.54  0.51  0.18 0.73 0.268 3.0
## alb -0.75 -0.05 -0.33  0.25 0.75 0.253 1.6
## ta   0.89 -0.35 -0.02 -0.05 0.92 0.082 1.3
## tas  0.90 -0.35  0.02 -0.04 0.94 0.063 1.3
## ts   0.90 -0.37  0.03 -0.04 0.94 0.062 1.3
## ua   0.02  0.47 -0.05  0.08 0.23 0.767 1.1
## va   0.75 -0.21  0.02  0.08 0.62 0.380 1.2
## omg  0.06 -0.33  0.09 -0.69 0.60 0.401 1.5
## uas -0.56  0.47 -0.08  0.11 0.56 0.445 2.1
## vas -0.32  0.64 -0.20  0.14 0.58 0.421 1.8
## slp -0.76  0.49 -0.03 -0.19 0.86 0.136 1.9
## Qdv -0.06 -0.05 -0.01 -0.80 0.64 0.360 1.0
## shm  0.87 -0.21 -0.12  0.05 0.81 0.186 1.2
## clt -0.38  0.67  0.28  0.19 0.71 0.293 2.2
## pre  0.50  0.67  0.04  0.34 0.82 0.182 2.4
## pme -0.41  0.77 -0.05  0.13 0.77 0.226 1.6
## ro  -0.05  0.03  0.91 -0.05 0.84 0.164 1.0
## dS  -0.28  0.53 -0.71  0.13 0.88 0.120 2.3
## snd -0.77 -0.01 -0.28  0.29 0.75 0.247 1.6
## 
##                        RC1  RC2  RC3  RC4
## SS loadings           8.79 5.66 2.08 1.65
## Proportion Var        0.37 0.24 0.09 0.07
## Cumulative Var        0.37 0.60 0.69 0.76
## Proportion Explained  0.48 0.31 0.11 0.09
## Cumulative Proportion 0.48 0.79 0.91 1.00
## 
## Mean item complexity =  1.7
## Test of the hypothesis that 4 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.06 
##  with the empirical chi square  290.26  with prob &lt;  1.5e-06 
## 
## Fit based upon off diagonal values = 0.99</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qgraph_loadings_plot</span>(mm_pca_rot, <span class="st">&quot;Rotated component loadings, all models over all months&quot;</span>) </span></code></pre></div>
<p><img src="lec16_files/figure-html/unnamed-chunk-14-1.png" width="2100" /><img src="lec16_files/figure-html/unnamed-chunk-14-2.png" width="2100" /></p>
<p><a href="lec16.html">[Back to top]</a></p>
</div>
</div>
<div id="readings" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Readings</h1>
<ul>
<li>Chapter 25, Multivariate Statistics, in Crawley, M.J. (2013) <em>The R Book</em>, Wiley. To get to the book, visit <a href="http://library.uoregon.edu">http://library.uoregon.edu</a>, login if necessary, and search for the 2013 edition of the book. Here’s a direct link, once you’re logged on: <a href="http://onlinelibrary.wiley.com/book/10.1002/9781118448908">[Link]</a></li>
<li>Everitt and Hothorn (2011) <em>An Introduction to Applied Multivariate Analysis with R</em>, ch. 3 and 5. To get to the book, visit <a href="http://library.uoregon.edu">http://library.uoregon.edu</a>, search for the book, and login if necessary. Here’s a direct link, once you’re logged on: <a href="https://na01.alma.exlibrisgroup.com/view/action/uresolver.do?operation=resolveService&amp;package_service_id=23665350240001852&amp;institutionId=1852&amp;customerId=1840">[Link]</a></li>
<li>Peng (2016) <em>Exploratory Data Analysis with R</em>, ch. 13. See readings tab for a link to the e-book.</li>
</ul>
<p><a href="lec16.html">[Back to top]</a></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
